#!/usr/bin/python

import urllib2
import time
import random
import sys

BASE_PATH = "http://server/process.php?"

USERNAME_PARTS = ["user", "name"]

users = []

def sleep():
	time.sleep(1)

def urlopen(url):
	print "opening url: " + url
	print "response:"
	try:
	    print urllib2.urlopen(url).read()
	except Exception, e:
		print "exception thrown (not able to connect to server?)"
		print e
	sleep()

def add_random_account():
	namepart1 = random.choice(USERNAME_PARTS)
	namepart2 = random.choice(USERNAME_PARTS)
	number = random.randrange(0, 1000)
	name = namepart1 + namepart2 + str(number)
	password = str(random.randrange(0, 9817)) + "lkjw109ubs" + str(random.randrange(55, 97))
	user = {'user': name, 'pass': password}
	users.append(user)
	url = BASE_PATH + build_username_password_url(user) + "&drop=register"
	urlopen(url)

def build_username_password_url(user):
	return "user=%s&pass=%s" % (user['user'], user['pass'])

def get_balance_history():
	user = random.choice(users)
	url = BASE_PATH + build_username_password_url(user) + "&drop=balance"
	urlopen(url)

def make_deposit():
	user = random.choice(users)
	url = BASE_PATH + build_username_password_url(user) + ("&amount=%d&drop=deposit" % random.randrange(1, 100000))
	urlopen(url)

def make_withdraw():
	user = random.choice(users)
	url = BASE_PATH + build_username_password_url(user) + ("&amount=%d&drop=withdraw" % random.randrange(1, 100000))
	urlopen(url)

COMMANDS = [
  add_random_account,
  get_balance_history,
  make_deposit,
  make_withdraw
]

def execute_random_command():
	command = random.choice(COMMANDS)

def main():
	add_random_account()
	while True:
		random.choice(COMMANDS)()

main()